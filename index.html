<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Doctor - AI-Powered Healthcare Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* CSS Variables */
        :root {
            --primary: #2b6cb0;
            --primary-dark: #2c5282;
            --secondary: #4299e1;
            --accent: #48bb78;
            --danger: #e53e3e;
            --light: #f7fafc;
            --dark: #2d3748;
            --gray: #a0aec0;
            --success: #48bb78;
            --warning: #ed8936;
        }
        
        /* Doctor Approval System Styles */
        .approval-system {
            background: #fff;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary);
        }
        
        .approval-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .approval-header h3 {
            color: var(--primary-dark);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .approval-status {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .status-item {
            flex: 1;
            min-width: 200px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .status-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .status-pending {
            color: #e67e22;
        }
        
        .status-approved {
            color: var(--success);
        }
        
        .status-rejected {
            color: var(--danger);
        }
        
        .status-label {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .status-description {
            font-size: 0.9rem;
            color: var(--dark);
        }
        
        .approval-timeline {
            margin: 25px 0;
            position: relative;
            padding-left: 30px;
        }
        
        .timeline-item {
            margin-bottom: 25px;
            position: relative;
        }
        
        .timeline-item:last-child {
            margin-bottom: 0;
        }
        
        .timeline-dot {
            position: absolute;
            left: -30px;
            top: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.7rem;
        }
        
        .timeline-content {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        
        .timeline-date {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .timeline-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary-dark);
        }
        
        .timeline-description {
            font-size: 0.9rem;
            color: var(--dark);
        }
        
        .current-status {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .current-status-icon {
            font-size: 2rem;
            color: var(--primary);
        }
        
        .doctor-card {
            display: flex;
            gap: 15px;
            align-items: center;
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
            margin: 20px 0;
        }
        
        .doctor-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }
        
        .doctor-info h4 {
            margin: 0 0 5px 0;
            color: var(--primary-dark);
        }
        
        .doctor-specialty {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .doctor-rating {
            color: #f39c12;
            font-size: 0.9rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .estimated-time {
            background: #fff4e6;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .estimated-time i {
            color: #e67e22;
            font-size: 1.2rem;
        }
        
        .progress-container {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            width: 65%;
            transition: width 0.5s ease;
        }
        
        /* Animation for status updates */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .status-update {
            animation: pulse 2s infinite;
        }
        
        /* Compliance-specific styles */
        .compliance-section {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary);
            padding: 20px;
            margin: 25px 0;
            border-radius: 5px;
        }
        
        .compliance-checkbox {
            margin-right: 10px;
        }
        
        .compliance-label {
            font-weight: 500;
            display: flex;
            align-items: flex-start;
        }
        
        .legal-links {
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .legal-links a {
            color: var(--primary);
            text-decoration: none;
            margin-right: 15px;
        }
        
        .legal-links a:hover {
            text-decoration: underline;
        }
        
        .consent-recording {
            background-color: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: center;
        }
        
        .compliance-required {
            border: 1px solid var(--danger);
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            background-color: #fff5f5;
        }
        
        .privacy-modal {
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .terms-section {
            margin-bottom: 20px;
        }
        
        .medicine-availability {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #ccc;
            width: 100%;
        }
        
        .availability-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
            align-items: center;
        }
        
        .availability-item i {
            margin-right: 5px;
        }
        
        .in-stock {
            color: var(--success);
            font-weight: 500;
        }
        
        .out-of-stock {
            color: var(--danger);
            font-weight: 500;
        }
        
        .quantity {
            font-size: 0.8rem;
            color: var(--gray);
            margin-left: 5px;
        }
        
        /* Treatment Tracker Styles */
        .treatment-tracker {
            padding: 60px 0;
            background: linear-gradient(135deg, #f0f4f8 0%, #e6eef7 100%);
        }
        
        .tracker-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 900px) {
            .tracker-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .tracker-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .tracker-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .tracker-header h3 {
            color: var(--primary-dark);
        }
        
        .tracker-split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .tracker-input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--gray);
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .tracker-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--gray);
            border-radius: 5px;
            min-height: 80px;
            resize: vertical;
            margin-bottom: 10px;
        }
        
        .tracker-task {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--light);
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .tracker-progress {
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .tracker-progress-bar {
            height: 100%;
            background: var(--success);
            transition: width 0.3s ease;
        }
        
        .tracker-pill {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: var(--light);
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--dark);
        }
        
        .tracker-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            background: #e6eef7;
            border-radius: 15px;
            font-size: 0.8rem;
            color: var(--primary-dark);
        }
        
        .tracker-list {
            display: grid;
            gap: 10px;
        }
        
        .tracker-empty {
            text-align: center;
            color: var(--gray);
            padding: 20px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .approval-status {
                flex-direction: column;
            }
            
            .status-item {
                min-width: 100%;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn-outline {
                width: 100%;
                text-align: center;
            }
            
            .consultation-container {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                gap: 15px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .diagnosis-result {
                position: static;
            }
            
            .body-map {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .login-container {
                padding: 30px 20px;
            }
            
            .social-login {
                flex-direction: column;
            }
            
            .remember-forgot {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .modal-content {
                padding: 20px 15px;
            }
            
            .tracker-split {
                grid-template-columns: 1fr;
            }
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Progress Bar Animation */
        @keyframes progressAnimation {
            0% { width: 0%; }
            100% { width: var(--progress-value); }
        }
        
        .progress-container {
            width: 100%;
            background-color: #e2e8f0;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 10px;
            background: linear-gradient(90deg, #48bb78, #38a169);
            border-radius: 5px;
            animation: progressAnimation 1.5s ease-in-out;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7f9;
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .logo i {
            font-size: 1.8rem;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s;
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        nav a:hover, nav a.active {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .auth-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }
        
        .btn {
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid white;
            color: white;
        }
        
        .btn-primary {
            background: var(--accent);
            color: white;
        }
        
        /* Hero Section */
        .hero {
            padding: 60px 0;
            background: linear-gradient(rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.9)), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f0f4f8"/><path d="M0 0L100 100" stroke="%23e6e6e6" stroke-width="1"/><path d="M100 0L0 100" stroke="%23e6e6e6" stroke-width="1"/></svg>');
            text-align: center;
        }
        
        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--primary-dark);
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 30px;
            color: var(--dark);
        }
        
        /* Features Section */
        .features {
            padding: 60px 0;
            background-color: white;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 40px;
            color: var(--primary-dark);
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .feature-card {
            background: var(--light);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        /* Consultation Section */
        .consultation {
            padding: 60px 0;
            background: linear-gradient(135deg, #f0f4f8 0%, #e6eef7 100%);
        }
        
        .consultation-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: start;
        }
        
        .input-methods {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .input-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .input-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .input-header i {
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .symptom-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gray);
            border-radius: 5px;
            resize: vertical;
            min-height: 100px;
        }
        
        .voice-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .voice-btn:hover {
            background: var(--primary-dark);
        }
        
        .body-map {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .body-part {
            padding: 10px;
            background: var(--light);
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .body-part:hover, .body-part.selected {
            background: var(--primary);
            color: white;
        }
        
        .body-part i {
            font-size: 1.5rem;
        }
        
        .diagnosis-result {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 100px;
        }
        
        .confidence-meter {
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .confidence-level {
            height: 100%;
            background: var(--success);
            transition: width 0.5s ease;
        }
        
        .accuracy-display {
            display: flex;
            justify-content: space-between;
            margin: 10px 0 20px;
            align-items: center;
        }
        
        .accuracy-value {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        .diagnosis-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .diagnosis-item:last-child {
            border-bottom: none;
        }
        
        .diagnosis-item h4 {
            color: var(--primary-dark);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .diagnosis-item i {
            font-size: 1.2rem;
            color: var(--primary);
        }
        
        .pharmacy-locator {
            margin-top: 25px;
        }
        
        .pharmacy-card {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: var(--light);
            border-radius: 5px;
            margin-top: 15px;
        }
        
        /* Loading spinner */
        .spinner {
            display: none;
            width: 40px;
            height: 40px;
            margin: 20px auto;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Forum Section */
        .forum {
            padding: 60px 0;
            background: white;
        }
        
        .forum-posts {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        .forum-post {
            padding: 20px;
            background: var(--light);
            border-radius: 10px;
        }
        
        .post-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 40px 0 20px;
            margin-top: auto;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .footer-section h3 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Page Styles */
        .page {
            display: none;
            min-height: calc(100vh - 200px);
        }
        
        .page.active {
            display: block;
        }
        
        /* Login Page Styles */
        .login-page-content {
            background: linear-gradient(120deg, #e0f2fe 0%, #bbdefb 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            flex: 1;
        }
        
        .login-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 450px;
            padding: 40px;
            transition: all 0.3s ease;
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-header h2 {
            color: var(--primary-dark);
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .login-header p {
            color: var(--gray);
            font-size: 16px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .input-with-icon {
            position: relative;
        }
        
        .input-with-icon i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            z-index: 1;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 15px 14px 45px;
            border: 1px solid var(--gray);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(43, 108, 176, 0.2);
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            cursor: pointer;
            z-index: 2;
        }
        
        .remember-forgot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .remember-me {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .forgot-password {
            color: var(--primary);
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
        }
        
        .forgot-password:hover {
            text-decoration: underline;
        }
        
        .btn-login {
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            position: relative;
        }
        
        .btn-login:hover {
            background: var(--primary-dark);
        }
        
        .btn-login:disabled {
            background: var(--gray);
            cursor: not-allowed;
        }
        
        .btn-loading .btn-text {
            visibility: hidden;
        }
        
        .btn-loading::after {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            margin: auto;
            border: 3px solid transparent;
            border-top-color: #ffffff;
            border-radius: 50%;
            animation: button-loading-spinner 1s ease infinite;
        }
        
        @keyframes button-loading-spinner {
            from {
                transform: rotate(0turn);
            }
            to {
                transform: rotate(1turn);
            }
        }
        
        .separator {
            display: flex;
            align-items: center;
            margin: 25px 0;
            color: var(--gray);
        }
        
        .separator::before,
        .separator::after {
            content: "";
            flex: 1;
            border-bottom: 1px solid var(--gray);
        }
        
        .separator span {
            padding: 0 15px;
            font-size: 14px;
        }
        
        .social-login {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            justify-content: center;
            align-items: center;
        }
        
        .btn-social {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--gray);
            border-radius: 8px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s;
            max-width: 150px;
        }
        
        .btn-social:hover {
            background: #f7f7f7;
            transform: translateY(-2px);
        }
        
        .signup-link {
            text-align: center;
            margin-top: 20px;
            color: var(--dark);
        }
        
        .signup-link a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }
        
        .signup-link a:hover {
            text-decoration: underline;
        }
        
        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-error {
            background-color: #fed7d7;
            color: #c53030;
            border: 1px solid #feb2b2;
        }
        
        .alert-success {
            background-color: #c6f6d5;
            color: #2d784d;
            border: 1px solid #9ae6b4;
        }
        
        .alert-info {
            background-color: #bee3f8;
            color: #2c5282;
            border: 1px solid #90cdf4;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        /* New Accessibility Improvements */
        .btn:focus, .voice-btn:focus, .body-part:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }
        
        .skip-to-content {
            position: absolute;
            left: -10000px;
            top: auto;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
        
        .skip-to-content:focus {
            position: static;
            width: auto;
            height: auto;
            background: var(--primary);
            color: white;
            padding: 10px;
            text-decoration: none;
        }
        
        /* Animation for the container */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-container {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* API Alert Styles */
        .api-alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }
        
        .api-alert.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }
        
        .api-alert.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }
        
        /* API Result Styles */
        .diagnosis-text {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            margin-bottom: 20px;
            white-space: pre-line;
        }
        
        .recommendation {
            background: #fff8e1;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            margin-bottom: 20px;
        }
        
        /* New styles for virtual consultation booking */
        .virtual-consult-btn {
            margin-top: 15px;
            padding: 10px 15px;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s;
            width: 100%;
            justify-content: center;
        }
        
        .virtual-consult-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .consultation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .consultation-modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        
        .consultation-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .consultation-modal-header h3 {
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-consultation-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .consultation-form-group {
            margin-bottom: 20px;
        }
        
        .consultation-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .consultation-form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--gray);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .consultation-form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(43, 108, 176, 0.2);
        }
        
        .consultation-time-slots {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .time-slot {
            padding: 10px;
            border: 1px solid var(--gray);
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .time-slot:hover {
            background-color: #f0f4f8;
        }
        
        .time-slot.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .btn-book-consultation {
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 20px;
        }
        
        .btn-book-consultation:hover {
            background: var(--primary-dark);
        }
        
        .consultation-success {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .consultation-success i {
            font-size: 3rem;
            color: var(--success);
            margin-bottom: 15px;
        }
        
        /* Doctor selection styles */
        .doctor-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .doctor-option {
            padding: 15px;
            border: 1px solid var(--gray);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .doctor-option:hover {
            background-color: #f0f4f8;
        }
        
        .doctor-option.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .doctor-option img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-to-content">Skip to main content</a>
    
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-stethoscope" aria-hidden="true"></i>
                <span>Smart Doctor</span>
            </div>
            
            <nav aria-label="Main navigation">
                <ul>
                    <li><a href="#" class="nav-link active" data-page="home">Home</a></li>
                    <li><a href="#" class="nav-link" data-page="consultation">Consultation</a></li>
                    <li><a href="#" class="nav-link" data-page="approval">Approvals</a></li>
                    <li><a href="#" class="nav-link" data-page="tracker">Treatment Tracker</a></li>
                    <li><a href="#">Forum</a></li>
                    <li><a href="#">About Us</a></li>
                </ul>
            </nav>
            
            <div class="auth-buttons" id="auth-buttons">
                <button class="btn btn-outline" id="login-button">Log In</button>
                <button class="btn btn-primary" id="signup-button">Sign Up</button>
                <div class="user-info" id="user-info" style="display: none;">
                    <i class="fas fa-user-circle"></i>
                    <span id="user-email"></span>
                    <button class="btn btn-outline" id="logout-button" style="padding: 5px 10px; margin-left: 10px;">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <main id="main-content">
        <!-- Home Page -->
        <div id="home-page" class="page active">
            <!-- Compliance Notice Banner -->
            <div class="compliance-required" style="margin: 0; border-radius: 0; text-align: center;">
                <i class="fas fa-exclamation-triangle"></i> 
                <strong>Important Notice:</strong> Smart Doctor is an AI assistant for informational purposes only and does not provide medical advice, diagnosis, or treatment. Always consult a healthcare professional for personal medical concerns.
            </div>
   
            <!-- Hero Section -->
            <section class="hero">
                <div class="container">
                    <h1>AI-Powered Healthcare at Your Fingertips</h1>
                    <p>Get instant medical guidance, accurate diagnoses, and pharmacy-ready prescriptions anytime, anywhere - in multiple languages.</p>
                    <button class="btn btn-primary go-to-consultation" style="padding: 12px 30px; font-size: 1.1rem;">
                        <i class="fas fa-comment-medical" aria-hidden="true"></i> Start Consultation
                    </button>
                </div>
            </section>

            <!-- Features Section -->
            <section class="features">
                <div class="container">
                    <h2 class="section-title">How Smart Doctor Helps You</h2>
                    
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-diagnoses" aria-hidden="true"></i>
                            </div>
                            <h3>AI-Powered Diagnosis</h3>
                            <p>Our advanced BioBERT AI technology provides accurate diagnoses with confidence scores so you understand the reasoning.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-prescription" aria-hidden="true"></i>
                            </div>
                            <h3>Digital Prescriptions</h3>
                            <p>Receive pharmacy-ready prescriptions with clear dosage instructions for your specific condition.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                            </div>
                            <h3>Pharmacy Locator</h3>
                            <p>Find nearby pharmacies with our geolocation technology and get directions to fill your prescription.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-globe" aria-hidden="true"></i>
                            </div>
                            <h3>Multilingual Support</h3>
                            <p>Access healthcare guidance in your preferred language through voice or text input.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-users" aria-hidden="true"></i>
                            </div>
                            <h3>Community Forum</h3>
                            <p>Connect with others, share experiences, and get support from our community of users and healthcare professionals.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-bell" aria-hidden="true"></i>
                            </div>
                            <h3>Follow-up Reminders</h3>
                            <p>Get proactive notifications for medication reminders and follow-up consultations.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Forum Preview Section -->
            <section class="forum">
                <div class="container">
                    <h2 class="section-title">Community Questions & Answers</h2>
                    
                    <div class="forum-posts">
                        <div class="forum-post">
                            <div class="post-header">
                                <h3>How to manage seasonal allergies?</h3>
                                <span class="post-date">Posted 2 days ago</span>
                            </div>
                            <p>I've been experiencing sneezing and itchy eyes every morning. What has worked for others in managing seasonal allergies?</p>
                            <div class="post-stats">
                                <span><i class="fas fa-comments" aria-hidden="true"></i> 12 answers</span>
                            </div>
                        </div>
                        
                        <div class="forum-post">
                            <div class="post-header">
                                <h3>Best ways to reduce fever in adults?</h3>
                                <span class="post-date">Posted 5 days ago</span>
                            </div>
                            <p>What methods have you found effective for reducing fever without medication? Looking for natural remedies.</p>
                            <div class="post-stats">
                                <span><i class="fas fa-comments" aria-hidden="true"></i> 8 answers</span>
                            </div>
                        </div>
                        
                        <div class="forum-post">
                            <div class="post-header">
                                <h3>Dealing with chronic back pain</h3>
                                <span class="post-date">Posted 1 week ago</span>
                            </div>
                            <p>I've had persistent lower back pain for months. Has anyone found exercises or treatments that provide relief?</p>
                            <div class="post-stats">
                                <span><i class="fas fa-comments" aria-hidden="true"></i> 15 answers</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary">
                            <i class="fas fa-plus" aria-hidden="true"></i> Ask a Question
                        </button>
                    </div>
                </div>
            </section>
        </div>

        <!-- Consultation Page -->
        <div id="consultation-page" class="page">
            <!-- Consultation Section -->
            <section class="consultation">
                <div class="container">
                    <h2 class="section-title">Start Your Consultation</h2>
                    
                    <!-- Legal Compliance Section -->
                    <div class="compliance-section">
                        <h3><i class="fas fa-shield-alt"></i> Privacy & Legal Compliance</h3>
                        <p>Before using our services, please acknowledge the following:</p>
                        
                        <div style="margin: 15px 0;">
                            <label class="compliance-label">
                                <input type="checkbox" class="compliance-checkbox" id="consent-privacy">
                                I have read and agree to the <a href="#" id="privacy-policy-link">Privacy Policy</a> and consent to the processing of my health data as described therein.
                            </label>
                        </div>
                        
                        <div style="margin: 15px 0;">
                            <label class="compliance-label">
                                <input type="checkbox" class="compliance-checkbox" id="consent-terms">
                                I agree to the <a href="#" id="terms-of-use-link">Terms of Use</a> and understand that Smart Doctor provides informational support only, not medical advice.
                            </label>
                        </div>
                        
                        <div style="margin: 15px 0;">
                            <label class="compliance-label">
                                <input type="checkbox" class="compliance-checkbox" id="consent-disclaimer">
                                I understand that AI-generated health information is for informational purposes only and should not replace professional medical advice.
                            </label>
                        </div>
                        
                        <div class="legal-links">
                            <a href="#" id="data-rights-link">Your Data Rights</a>
                            <a href="#" id="cookie-policy-link">Cookie Policy</a>
                            <a href="#" id="hipaa-info-link">HIPAA Information</a>
                        </div>
                    </div>
                    
                    <div class="consultation-container">
                        <div class="input-methods">
                            <div class="api-alert error" id="api-error-alert"></div>
                            
                            <div class="input-card">
                                <div class="input-header">
                                    <i class="fas fa-keyboard" aria-hidden="true"></i>
                                    <h3>Describe Your Symptoms</h3>
                                </div>
                                <textarea class="symptom-input" id="symptom-input" placeholder="Describe how you're feeling, your symptoms, and any other relevant information..." aria-label="Describe your symptoms"></textarea>
                            </div>
                            
                            <div class="input-card">
                                <div class="input-header">
                                    <i class="fas fa-microphone" aria-hidden="true"></i>
                                    <h3>Use Voice Input</h3>
                                </div>
                                <button class="voice-btn" aria-label="Start voice recording">
                                    <i class="fas fa-microphone" aria-hidden="true"></i> Start Recording
                                </button>
                            </div>
                            
                            <div class="input-card">
                                <div class="input-header">
                                    <i class="fas fa-body" aria-hidden="true"></i>
                                    <h3>Select Affected Area</h3>
                                </div>
                                <div class="body-map">
                                    <div class="body-part" data-region="head" tabindex="0">
                                        <i class="fas fa-brain"></i>
                                        <span>Head</span>
                                    </div>
                                    <div class="body-part" data-region="eyes" tabindex="0">
                                        <i class="fas fa-eye"></i>
                                        <span>Eyes</span>
                                    </div>
                                    <div class="body-part" data-region="ears" tabindex="0">
                                        <i class="fas fa-ear"></i>
                                        <span>Ears</span>
                                    </div>
                                    <div class="body-part" data-region="nose" tabindex="0">
                                        <i class="fas fa-wind"></i>
                                        <span>Nose</span>
                                    </div>
                                    <div class="body-part" data-region="throat" tabindex="0">
                                        <i class="fas fa-comment-medical"></i>
                                        <span>Throat</span>
                                    </div>
                                    <div class="body-part" data-region="chest" tabindex="0">
                                        <i class="fas fa-lungs"></i>
                                        <span>Chest</span>
                                    </div>
                                    <div class="body-part" data-region="stomach" tabindex="0">
                                        <i class="fas fa-stomach"></i>
                                        <span>Stomach</span>
                                    </div>
                                    <div class="body-part" data-region="back" tabindex="0">
                                        <i class="fas fa-bone"></i>
                                        <span>Back</span>
                                    </div>
                                    <div class="body-part" data-region="arms" tabindex="0">
                                        <i class="fas fa-hand-paper"></i>
                                        <span>Arms</span>
                                    </div>
                                    <div class="body-part" data-region="legs" tabindex="0">
                                        <i class="fas fa-running"></i>
                                        <span>Legs</span>
                                    </div>
                                    <div class="body-part" data-region="skin" tabindex="0">
                                        <i class="fas fa-allergies"></i>
                                        <span>Skin</span>
                                    </div>
                                    <div class="body-part" data-region="general" tabindex="0">
                                        <i class="fas fa-user-md"></i>
                                        <span>General</span>
                                    </div>
                                </div>
                                <div class="selected-symptoms" id="selected-symptoms" aria-live="polite"></div>
                            </div>
                            
                            <button class="btn btn-primary" id="diagnose-btn" style="padding: 15px; font-size: 1.1rem;">
                                <i class="fas fa-stethoscope" aria-hidden="true"></i> Get Diagnosis
                            </button>
                            
                            <div class="spinner" id="loading-spinner" aria-hidden="true"></div>
                        </div>
                        
                        <div class="diagnosis-result">
                            <h3>Diagnosis Results</h3>
                            <div id="result-placeholder">
                                <p>Enter your symptoms to get started with your AI-powered diagnosis.</p>
                                <p>The AI will provide:</p>
                                <ul>
                                    <li>Possible condition names</li>
                                    <li>Brief explanation in simple terms</li>
                                    <li>Recommended home care advice</li>
                                    <li>When to seek immediate medical attention</li>
                                </ul>
                            </div>
                            
                            <div id="diagnosis-result-container" style="display: none;">
                                <div class="accuracy-display">
                                    <span>Confidence Level:</span>
                                    <span class="accuracy-value" id="accuracy-value">85%</span>
                                </div>
                                
                                <div class="progress-container">
                                    <div class="progress-bar" id="confidence-progress" style="width: 85%"></div>
                                </div>
                                
                                <div class="diagnosis-item">
                                    <h4><i class="fas fa-disease"></i> Condition:</h4>
                                    <p id="condition-name">Common Cold</p>
                                </div>
                                
                                <div class="diagnosis-item">
                                    <h4><i class="fas fa-stethoscope"></i> Diagnosis:</h4>
                                    <p id="diagnosis-details">Based on your symptoms of headache and fever, this appears to be a common viral infection.</p>
                                </div>
                                
                                <div class="diagnosis-item">
                                    <h4><i class="fas fa-pills"></i>Treatment Options</h4>
                                    <p id="prescription-info">Paracetamol 500mg every 6 hours, Ibuprofen 400mg every 8 hours as needed for pain/fever</p>
                                </div>
                                
                                <div class="diagnosis-item">
                                    <h4><i class="fas fa-heartbeat"></i> Treatment Plan:</h4>
                                    <p id="treatment-plan">Rest, hydrate, use over-the-counter cold medication, and monitor symptoms. If fever persists beyond 3 days, consult a doctor.</p>
                                </div>
                                
                                <div class="recommendation">
                                    <h4><i class="fas fa-exclamation-triangle"></i> Important Notice</h4>
                                    <p>This information is provided by an AI assistant and is not a substitute for professional medical advice. 
                                    Always consult with a healthcare provider for proper diagnosis and treatment.</p>
                                </div>
                                
                                <div class="pharmacy-locator">
                                    <h4><i class="fas fa-map-marker-alt"></i> Nearby Pharmacies</h4>
                                    <div class="pharmacy-card">
                                        <i class="fas fa-clinic-medical" style="font-size: 1.5rem;" aria-hidden="true"></i>
                                        <div>
                                            <h5>Medi-Rite Pharmacy</h5>
                                            <p>1.2 km away | Open until 8 PM</p>
                                            <div class="medicine-availability">
                                                <div class="availability-item">
                                                    <span><i class="fas fa-pills"></i> Paracetamol 500mg:</span>
                                                    <span class="in-stock" id="medi-rite-paracetamol">In Stock <span class="quantity">(25 packs)</span></span>
                                                </div>
                                                <div class="availability-item">
                                                    <span><i class="fas fa-capsules"></i> -:</span>
                                                    <span class="in-stock" id="medi-rite-ibuprofen">In Stock <span class="quantity">(18 packs)</span></span>
                                                </div>
                                            </div>
                                            <!-- Virtual Consultation Button -->
                                            <button class="virtual-consult-btn" id="virtual-consult-medi-rite">
                                                <i class="fas fa-video"></i> Book Virtual Consultation
                                            </button>
                                        </div>
                                    </div>
                                    <div class="pharmacy-card">
                                        <i class="fas fa-clinic-medical" style="font-size: 1.5rem;" aria-hidden="true"></i>
                                        <div>
                                            <h5>City Health Pharmacy</h5>
                                            <p>2.3 km away | Open until 9 PM</p>
                                            <div class="medicine-availability">
                                                <div class="availability-item">
                                                    <span><i class="fas fa-pills"></i> Paracetamol 500mg:</span>
                                                    <span class="out-of-stock" id="city-health-paracetamol">Out of Stock</span>
                                                </div>
                                                <div class="availability-item">
                                                    <span><i class="fas fa-capsules"></i> Ibuprofen 400mg:</span>
                                                    <span class="in-stock" id="city-health-ibuprofen">In Stock <span class="quantity">(5 packs)</span></span>
                                                </div>
                                            </div>
                                            <!-- Virtual Consultation Button -->
                                            <button class="virtual-consult-btn" id="virtual-consult-city-health">
                                                <i class="fas fa-video"></i> Book Virtual Consultation
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Doctor Approval Section in Results -->
                                <div class="approval-system" style="margin-top: 30px;">
                                    <div class="approval-header">
                                        <h3><i class="fas fa-user-md"></i> Doctor Approval Process</h3>
                                    </div>
                                    
                                    <div class="current-status">
                                        <div class="current-status-icon">
                                            <i class="fas fa-clock"></i>
                                        </div>
                                        <div>
                                            <h4>Pending Medical Review</h4>
                                            <p>Your AI-generated diagnosis has been submitted for verification by our medical team.</p>
                                        </div>
                                    </div>
                                    
                                    <div class="estimated-time">
                                        <i class="fas fa-info-circle"></i>
                                        <div>
                                            <strong>Estimated review time:</strong> 5-10 minutes during business hours 
                                        </div>
                                    </div>
                                    
                                    <div class="action-buttons">
                                        <button class="btn btn-primary" id="view-approval-status">
                                            <i class="fas fa-clipboard-list"></i> View Approval Status
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        
        <!-- Doctor Approval Page -->
        <div id="approval-page" class="page">
            <section class="consultation">
                <div class="container">
                    <h2 class="section-title">Doctor Approval Status</h2>
                    
                    <div class="approval-system">
                        <div class="approval-header">
                            <h3><i class="fas fa-user-md"></i> Pending Medical Review</h3>
                        </div>
                        
                        <div class="current-status">
                            <div class="current-status-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <h4>Waiting for Doctor's Approval</h4>
                                <p>Your prescription and diagnosis are currently being reviewed by our medical team.</p>
                            </div>
                        </div>
                        
                        <div class="approval-status">
                            <div class="status-item">
                                <div class="status-icon status-pending">
                                    <i class="fas fa-file-prescription"></i>
                                </div>
                                <div class="status-label">Prescription Status</div>
                                <div class="status-description">Pending Review</div>
                            </div>
                            
                            <div class="status-item">
                                <div class="status-icon status-pending">
                                    <i class="fas fa-diagnoses"></i>
                                </div>
                                <div class="status-label">Diagnosis Status</div>
                                <div class="status-description">Pending Review</div>
                            </div>
                            
                            <div class="status-item">
                                <div class="status-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="status-label">Estimated Time</div>
                                <div class="status-description">10-15 minutes</div>
                            </div>
                        </div>
                        
                        <div class="estimated-time">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <strong>Typical review time:</strong> 10 -15 minutes during business hours
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-bar" id="approval-progress"></div>
                        </div>
                        
                        <div class="doctor-card">
                            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'><rect width='60' height='60' fill='%232b6cb0'/><text x='30' y='36' font-family='Arial' font-size='20' text-anchor='middle' fill='white'>DR</text></svg>" alt="Doctor" class="doctor-avatar">
                            <div class="doctor-info">
                                <h4>Dr. Thabang Masondo</h4>
                                <div class="doctor-specialty">Internal Medicine Specialist</div>
                                <div class="doctor-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                    4.7 (128 reviews)
                                </div>
                            </div>
                        </div>
                        
                        <h4>Approval Timeline</h4>
                        <div class="approval-timeline">
                            <div class="timeline-item">
                                <div class="timeline-dot"><i class="fas fa-check"></i></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">Today, 10:15 AM</div>cvv
                                    <div class="timeline-title">AI Diagnosis Generated</div>
                                    <div class="timeline-description">Initial assessment completed by our AI system</div>
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-dot"><i class="fas fa-check"></i></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">Today, 10:20 AM</div>
                                    <div class="timeline-title">Sent for Medical Review</div>
                                    <div class="timeline-description">Case assigned to a licensed physician for verification</div>
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-dot"><i class="fas fa-ellipsis-h"></i></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">Pending</div>
                                    <div class="timeline-title">Doctor's Review</div>
                                    <div class="timeline-description">A licensed physician is examining your case</div>
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-dot"><i class="fas fa-ellipsis-h"></i></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">Pending</div>
                                    <div class="timeline-title">Approval Complete</div>
                                    <div class="timeline-description">You will receive notification once approved</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="refresh-status">
                                <i class="fas fa-sync-alt"></i> Refresh Status
                            </button>
                            <button class="btn btn-outline" id="contact-doctor">
                                <i class="fas fa-envelope"></i> Message Doctor
                            </button>
                            <button class="btn btn-outline" id="view-ai-results">
                                <i class="fas fa-eye"></i> View AI Results
                            </button>
                        </div>
                    </div>
                    
                    <!-- Sample of what an approved case would look like -->
                    <div class="approval-system" style="display: none;" id="approved-case">
                        <div class="approval-header">
                            <h3><i class="fas fa-check-circle" style="color: var(--success);"></i> Approved Medical Plan</h3>
                        </div>
                        
                        <div class="current-status" style="background: #e8f6ef;">
                            <div class="current-status-icon" style="color: var(--success);">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div>
                                <h4>Approved by Dr. Sarah Johnson</h4>
                                <p>Your prescription and diagnosis have been reviewed and approved by our medical team.</p>
                            </div>
                        </div>
                        
                        <div class="approval-status">
                            <div class="status-item">
                                <div class="status-icon status-approved">
                                    <i class="fas fa-file-prescription"></i>
                                </div>
                                <div class="status-label">Prescription Status</div>
                                <div class="status-description">Approved</div>
                            </div>
                            
                            <div class="status-item">
                                <div class="status-icon status-approved">
                                    <i class="fas fa-diagnoses"></i>
                                </div>
                                <div class="status-label">Diagnosis Status</div>
                                <div class="status-description">Approved</div>
                            </div>
                            
                            <div class="status-item">
                                <div class="status-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="status-label">Approved On</div>
                                <div class="status-description">Today, 1:45 PM</div>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-primary">
                                <i class="fas fa-download"></i> Download Prescription
                            </button>
                            <button class="btn btn-outline">
                                <i class="fas fa-share-alt"></i> Share with Pharmacy
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        
        <!-- Login Page -->
        <div id="login-page" class="page">
            <div class="login-page-content">
                
                <div class="login-container">
                    <div class="login-header">
                        <h2>Welcome Back</h2>
                        <p>Sign in to access your Smart Doctor account</p>
                    </div>
                    
                    <div id="alert-box"></div>
                    
                    <form id="login-form">
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <div class="input-with-icon">
                                <i class="fas fa-envelope"></i>
                                <input type="email" class="form-control" id="email" placeholder="Enter your email" required autocomplete="email">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="password">Password</label>
                            <div class="input-with-icon">
                                <i class="fas fa-lock"></i>
                                <input type="password" class="form-control" id="password" placeholder="Enter your password" required autocomplete="current-password">
                                <span class="password-toggle" id="password-toggle">
                                    <i class="far fa-eye"></i>
                                </span>
                            </div>
                        </div>
                       
                        <div class="remember-forgot">
                            <div class="remember-me">
                                <input type="checkbox" id="remember">
                                <label for="remember">Remember me</label>
                            </div>
                            <a href="#" class="forgot-password" id="forgot-password-link">Forgot password?</a>
                        </div>
                        
                        <button type="submit" class="btn-login" id="login-submit-button">
                            <span class="btn-text">Sign In</span>
                        </button>
                    </form>
                    
                    <div class="separator">
                        <span>Or continue with</span>
                    </div>
                    
                    <div class="social-login">
                        <button type="button" class="btn-social">
                            <i class="fab fa-google"></i>
                            <span>Google</span>
                        </button>
                        <button type="button" class="btn-social">
                            <i class="fab fa-facebook-f"></i>
                            <span>Facebook</span>
                        </button>
                    </div>
                    
                    <div class="signup-link">
                        Don't have an account? <a href="#" id="signup-link">Sign up now</a>
                    </div>

                    <!-- GDPR/Privacy Notice for Login -->
                    <div class="compliance-section" style="margin-top: 20px; font-size: 0.8rem;">
                        <p>By logging in, you agree to our <a href="#">Privacy Policy</a> and <a href="#">Terms of Service</a>. We use cookies to provide and improve our service. You can manage your preferences in settings.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Treatment Tracker Page -->
        <div id="tracker-page" class="page">
            <section class="treatment-tracker">
                <div class="container">
                    <h2 class="section-title">Treatment Plan Tracker</h2>
                    
                    <div class="tracker-grid">
                        <div class="tracker-card">
                            <div class="tracker-header">
                                <i class="fas fa-plus"></i>
                                <h3>Create / Update Treatment Plan</h3>
                            </div>
                            
                            <div class="tracker-split">
                                <div>
                                    <label>Plan Title</label>
                                    <input type="text" class="tracker-input" id="planTitle" placeholder="e.g., Post-surgery meds" />
                                </div>
                                <div>
                                    <label>Condition</label>
                                    <input type="text" class="tracker-input" id="planCondition" placeholder="e.g., Tonsillectomy" />
                                </div>
                            </div>
                            
                            <div class="tracker-split">
                                <div>
                                    <label>Start Date</label>
                                    <input type="date" class="tracker-input" id="planStart" />
                                </div>
                                <div>
                                    <label>End Date</label>
                                    <input type="date" class="tracker-input" id="planEnd" />
                                </div>
                            </div>
                            
                            <div>
                                <label>Notes</label>
                                <textarea class="tracker-textarea" id="planNotes" placeholder="Any important instructions, allergies, contact info for your doctor, etc."></textarea>
                            </div>
                            
                            <div class="tracker-card" style="margin-top: 14px;">
                                <div class="tracker-header">
                                    <i class="fas fa-capsules"></i>
                                    <h3>Tasks / Medications</h3>
                                    <span class="tracker-pill" style="margin-left: auto;">
                                        <i class="fa-regular fa-clock"></i>
                                        <span id="adherence">0%</span> adherence
                                    </span>
                                </div>
                                
                                <div class="tracker-split">
                                    <div>
                                        <label>Task / Medication</label>
                                        <input type="text" class="tracker-input" id="taskName" placeholder="e.g., Amoxicillin 500mg" />
                                    </div>
                                    <div>
                                        <label>Frequency</label>
                                        <select class="tracker-input" id="taskFreq">
                                            <option value="1">Once daily</option>
                                            <option value="2">Twice daily</option>
                                            <option value="3">Three times daily</option>
                                            <option value="custom">Custom times</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="tracker-split">
                                    <div>
                                        <label>Time(s)</label>
                                        <input type="text" class="tracker-input" id="taskTimes" placeholder="e.g., 08:00, 14:00, 20:00" />
                                    </div>
                                    <div>
                                        <label>&nbsp;</label>
                                        <button class="btn btn-primary" id="addTask" style="width: 100%;">
                                            <i class="fa-solid fa-plus"></i> Add
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="taskList" class="tracker-list" style="margin-top: 12px;"></div>
                                
                                <div class="tracker-progress">
                                    <div class="tracker-progress-bar" id="planProgress"></div>
                                </div>
                                
                                <div class="hint">Check tasks as you complete them today. Progress resets daily.</div>
                            </div>
                            
                            <div style="margin-top: 14px; display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn btn-primary" id="savePlan">
                                    <i class="fa-solid fa-floppy-disk"></i> Save Plan
                                </button>
                                <button class="btn" id="exportPlan">
                                    <i class="fa-solid fa-download"></i> Export (.json)
                                </button>
                                <label class="btn" for="importPlan">
                                    <i class="fa-solid fa-upload"></i> Import (.json)
                                </label>
                                <input id="importPlan" type="file" accept="application/json" style="display: none;" />
                                <button class="btn" style="background: var(--danger); color: white;" id="clearPlan">
                                    <i class="fa-solid fa-trash"></i> Clear All
                                </button>
                            </div>
                        </div>
                        
                        <div class="tracker-card">
                            <div class="tracker-header">
                                <i class="fas fa-list"></i>
                                <h3>My Saved Plans</h3>
                            </div>
                            
                            <div id="savedPlans" class="tracker-list"></div>
                            <div class="tracker-empty" id="savedEmpty">No plans saved yet.</div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Forgot Password Modal -->
    <div class="modal" id="forgot-password-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Reset Password</h3>
                <button class="close-modal">&times;</button>
            </div>
            <p>Enter your email address and we'll send you instructions to reset your password.</p>
            <form id="reset-password-form">
                <div class="form-group">
                    <label for="reset-email">Email Address</label>
                    <input type="email" class="form-control" id="reset-email" placeholder="Your email address" required>
                </div>
                <button type="submit" class="btn-login">Send Reset Instructions</button>
            </form>
        </div>
    </div>

    <!-- Virtual Consultation Modal -->
    <div class="consultation-modal" id="consultation-modal">
        <div class="consultation-modal-content">
            <div class="consultation-modal-header">
                <h3><i class="fas fa-video"></i> Virtual Doctor Consultation</h3>
                <button class="close-consultation-modal">&times;</button>
            </div>
            
            <div id="consultation-form">
                <div class="consultation-form-group">
                    <label for="consultation-pharmacy">Pharmacy</label>
                    <input type="text" class="consultation-form-control" id="consultation-pharmacy" readonly>
                </div>
                
                <div class="consultation-form-group">
                    <label for="consultation-name">Your Name</label>
                    <input type="text" class="consultation-form-control" id="consultation-name" placeholder="Enter your full name">
                </div>
                
                <div class="consultation-form-group">
                    <label for="consultation-email">Email Address</label>
                    <input type="email" class="consultation-form-control" id="consultation-email" placeholder="Enter your email">
                </div>
                
                <div class="consultation-form-group">
                    <label for="consultation-phone">Phone Number</label>
                    <input type="tel" class="consultation-form-control" id="consultation-phone" placeholder="Enter your phone number">
                </div>
                
                <div class="consultation-form-group">
                    <label for="consultation-date">Preferred Date</label>
                    <input type="date" class="consultation-form-control" id="consultation-date" min="">
                </div>
                
                <div class="consultation-form-group">
                    <label>Preferred Time Slot</label>
                    <div class="consultation-time-slots">
                        <div class="time-slot" data-time="09:00">9:00 AM</div>
                        <div class="time-slot" data-time="10:30">10:30 AM</div>
                        <div class="time-slot" data-time="12:00">12:00 PM</div>
                        <div class="time-slot" data-time="14:00">2:00 PM</div>
                        <div class="time-slot" data-time="15:30">3:30 PM</div>
                        <div class="time-slot" data-time="17:00">5:00 PM</div>
                    </div>
                </div>
                
                <div class="consultation-form-group">
                    <label for="consultation-reason">Reason for Consultation</label>
                    <textarea class="consultation-form-control" id="consultation-reason" rows="3" placeholder="Briefly describe the reason for your consultation"></textarea>
                </div>
                
                <button class="btn-book-consultation" id="book-consultation-btn">Book a Doctor Consultation</button>
            </div>
            
            <div class="consultation-success" id="consultation-success">
                <i class="fas fa-check-circle"></i>
                <h3>Consultation Booked Successfully!</h3>
                <p>Your virtual consultation has been scheduled. You will receive a confirmation email with the meeting link shortly.</p>
                <button class="btn-book-consultation" id="close-consultation-success">Close</button>
            </div>
        </div>
    </div>

    <!-- Legal Documents Modals -->
    <div class="modal" id="privacy-policy-modal">
        <div class="modal-content privacy-modal">
            <div class="modal-header">
                <h3>Privacy Policy</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="terms-section">
                <h4>1. Information We Collect</h4>
                <p>We collect information you provide directly to us, including health symptoms, medical history (if provided), and account information.</p>
                
                <h4>2. How We Use Your Information</h4>
                <p>We use your information to provide AI-powered health guidance, improve our services, and communicate with you. We do not sell your personal health information.</p>
                
                <h4>3. Data Security</h4>
                <p>We implement appropriate technical and organizational measures to protect your personal data against unauthorized access, alteration, or destruction.</p>
                
                <h4>4. Your Rights</h4>
                <p>You have the right to access, correct, or delete your personal information. Contact us at privacy@smartdoctor.com to exercise these rights.</p>
                
                <p>Last Updated: January 1, 2025</p>
            </div>
        </div>
    </div>

    <div class="modal" id="terms-of-use-modal">
        <div class="modal-content privacy-modal">
            <div class="modal-header">
                <h3>Terms of Service</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="terms-section">
                <h4>1. Service Description</h4>
                <p>Smart Doctor provides AI-powered health information and guidance for informational purposes only. It is not a substitute for professional medical advice.</p>
                
                <h4>2. User Responsibilities</h4>
                <p>You are responsible for providing accurate information and for how you use the AI-generated content. Always consult healthcare professionals for medical advice.</p>
                
                <h4>3. Disclaimer of Warranties</h4>
                <p>The service is provided "as is" without warranties of any kind. We do not guarantee the accuracy of health information provided by the AI.</p>
                
                <h4>4. Limitation of Liability</h4>
                <p>Smart Doctor shall not be liable for any damages resulting from your use of or inability to use the service or reliance on AI-generated health information.</p>
            </div>
        </div>
    </div>

    <!-- Doctor Messaging Modal -->
    <div class="modal" id="doctor-message-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Message Your Doctor</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="doctor-card" style="margin: 0 0 20px 0;">
                <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'><rect width='60' height='60' fill='%232b6cb0'/><text x='30' y='36' font-family='Arial' font-size='20' text-anchor='middle' fill='white'>DR</text></svg>" alt="Doctor" class="doctor-avatar">
                <div class="doctor-info">
                    <h4>Dr. Sarah Johnson</h4>
                    <div class="doctor-specialty">Internal Medicine Specialist</div>
                </div>
            </div>
            <form id="message-doctor-form">
                <div class="form-group">
                    <label for="message-subject">Subject</label>
                    <input type="text" class="form-control" id="message-subject" placeholder="Question about my prescription" required>
                </div>
                <div class="form-group">
                    <label for="message-content">Your Message</label>
                    <textarea class="form-control" id="message-content" rows="5" placeholder="Type your message to the doctor here..." required></textarea>
                </div>
                <button type="submit" class="btn-login">Send Message</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Smart Doctor</h3>
                    <p>AI-powered healthcare assistance for everyone, everywhere.</p>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul style="list-style: none;">
                        <li><a href="#" class="nav-link" data-page="home" style="color: white;">Home</a></li>
                        <li><a href="#" class="nav-link" data-page="consultation" style="color: white;">Consultation</a></li>
                        <li><a href="#" class="nav-link" data-page="approval" style="color: white;">Approvals</a></li>
                        <li><a href="#" class="nav-link" data-page="tracker" style="color: white;">Treatment Tracker</a></li>
                        <li><a href="#" style="color: white;">Forum</a></li>
                        <li><a href="#" style="color: white;">About Us</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <p>Email: support@smartdoctor.com</p>
                    <p>Phone: +27 123 456 789</p>
                </div>
                
                <div class="footer-section">
                    <h3>Legal</h3>
                    <div style="font-size: 0.8rem;">
                        <p><a href="#" style="color: white;">Privacy Policy</a> | <a href="#" style="color: white;">Terms of Service</a></p>
                        <p><a href="#" style="color: white;">Data Processing Agreement</a></p>
                        <p><a href="#" style="color: white;">HIPAA Compliance</a></p>
                        <p> 2025 Smart Doctor. All rights reserved.</p>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Smart Doctor. All rights reserved. | Code Wizards Team</p>
            </div>
        </div>
    </footer>

    <script>
        // Authentication state management
        let currentUser = null;
        
        // Dummy user data for demonstration
        const dummyUsers = [
            { email: 'Thabang@gmail.com', password: 'password123', name: 'Thabang' },
            { email: 'john.doe@example.com', password: 'john123', name: 'John Doe' },
            { email: 'jane.smith@example.com', password: 'jane123', name: 'Jane Smith' }
        ];
        
        // OpenRouter API Integration
        const OPENROUTER_API_KEY = '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';
        const OPENROUTER_API_URL = 'https://openrouter.ai/api/v1/chat/completions';
        
        // Check if user is logged in (from localStorage)
        function checkAuthStatus() {
            const savedUser = localStorage.getItem('smartDoctorUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUIForAuthState();
            }
        }
        
        // Update UI based on authentication state
        function updateUIForAuthState() {
            const authButtons = document.getElementById('auth-buttons');
            const userInfo = document.getElementById('user-info');
            const userEmail = document.getElementById('user-email');
            const loginBtn = document.getElementById('login-button');
            const signupBtn = document.getElementById('signup-button');
            
            if (currentUser) {
                // User is logged in
                authButtons.querySelector('.btn-outline').style.display = 'none';
                authButtons.querySelector('.btn-primary').style.display = 'none';
                userInfo.style.display = 'flex';
                userEmail.textContent = currentUser.email;
            } else {
                // User is not logged in
                authButtons.querySelector('.btn-outline').style.display = 'block';
                authButtons.querySelector('.btn-primary').style.display = 'block';
                userInfo.style.display = 'none';
            }
        }
        
        // Function to show API alert
        function showAPIAlert(message, type) {
            const alert = document.getElementById('api-error-alert');
            alert.textContent = message;
            alert.className = `api-alert ${type}`;
            alert.style.display = 'block';
            
            // Hide alert after 5 seconds
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }
        
        // Function to get AI diagnosis from OpenRouter
        async function getAIDiagnosis(symptoms, selectedBodyParts) {
            try {
                // Construct the prompt for medical diagnosis
                const prompt = `As a medical AI assistant, analyze these symptoms: ${symptoms}. 
                ${selectedBodyParts ? `Affected body parts: ${selectedBodyParts}.` : ''}
                Provide a concise response with only these 4 sections:
                1. Condition: [Possible condition name]
                2. Diagnosis: [Brief diagnosis explanation]
                3. Suggested Treatment Options: [Specific medication recommendations]
                4. Treatment Plan: [Concise treatment instructions]
                
                Keep each section very brief (1-2 sentences maximum). Do not include any other information or disclaimers.`;

                const response = await fetch(OPENROUTER_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENROUTER_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are a helpful medical assistant that provides preliminary health information. Always emphasize the importance of consulting healthcare professionals for proper diagnosis.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        temperature: 0.3,
                        max_tokens: 300
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('Error calling OpenRouter API:', error);
                throw error;
            }
        }
        
        // Function to parse AI response into structured data
        function parseAIResponse(response) {
            // Default values in case parsing fails
            let condition = "Common Cold";
            let diagnosis = "Based on your symptoms, this appears to be a common viral infection.";
            let prescription = "Paracetamol 500mg every 6 hours, Ibuprofen 400mg every 8 hours as needed";
            let treatment = "Rest, hydrate, use over-the-counter cold medication. If symptoms persist beyond 3 days, consult a doctor.";
            
            try {
                // Try to extract information based on the expected format
                const conditionMatch = response.match(/Condition:\s*(.+?)(?=\n|$)/i);
                const diagnosisMatch = response.match(/Diagnosis:\s*(.+?)(?=\n|$)/i);
                const prescriptionMatch = response.match(/Prescription:\s*(.+?)(?=\n|$)/i);
                const treatmentMatch = response.match(/Treatment Plan:\s*(.+?)(?=\n|$)/i);
                
                if (conditionMatch) condition = conditionMatch[1].trim();
                if (diagnosisMatch) diagnosis = diagnosisMatch[1].trim();
                if (prescriptionMatch) prescription = prescriptionMatch[1].trim();
                if (treatmentMatch) treatment = treatmentMatch[1].trim();
                
            } catch (e) {
                console.error("Error parsing AI response:", e);
            }
            
            return {
                condition,
                diagnosis,
                prescription,
                treatment
            };
        }
        
        // Page Navigation
        function navigateToPage(pageId) {
            // Update active page
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(`${pageId}-page`).classList.add('active');
            
            // Update active nav link
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(navLink => {
                navLink.classList.remove('active');
                if (navLink.getAttribute('data-page') === pageId) {
                    navLink.classList.add('active');
                }
            });
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            // If navigating to approval page, start simulation
            if (pageId === 'approval') {
                setTimeout(simulateApprovalProcess, 500);
            }
        }
        
        // Show alert function
        function showAlert(message, type) {
            // Create alert element if it doesn't exist
            let alertBox = document.getElementById('alert-box');
            if (!alertBox) {
                alertBox = document.createElement('div');
                alertBox.id = 'alert-box';
                alertBox.style.position = 'fixed';
                alertBox.style.top = '20px';
                alertBox.style.right = '20px';
                alertBox.style.zIndex = '10000';
                alertBox.style.maxWidth = '350px';
                document.body.appendChild(alertBox);
            }
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.style.marginBottom = '10px';
            alert.style.padding = '12px 15px';
            alert.style.borderRadius = '8px';
            alert.style.display = 'flex';
            alert.style.alignItems = 'center';
            alert.style.gap = '10px';
            
            // Set background and text color based on type
            if (type === 'error') {
                alert.style.backgroundColor = '#fed7d7';
                alert.style.color = '#c53030';
                alert.style.border = '1px solid #feb2b2';
                alert.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
            } else if (type === 'success') {
                alert.style.backgroundColor = '#c6f6d5';
                alert.style.color = '#2d784d';
                alert.style.border = '1px solid #9ae6b4';
                alert.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            } else {
                alert.style.backgroundColor = '#bee3f8';
                alert.style.color = '#2c5282';
                alert.style.border = '1px solid #90cdf4';
                alert.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
            }
            
            alertBox.appendChild(alert);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }
        
        // Doctor Approval System Functionality
        function simulateApprovalProcess() {
            const progressBar = document.getElementById('approval-progress');
            if (!progressBar) return;
            
            let progress = 65;
            
            // Animate progress bar
            const progressInterval = setInterval(() => {
                progress += Math.random() * 2;
                if (progress > 100) progress = 100;
                progressBar.style.width = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    
                    // Simulate approval after 10 seconds
                    setTimeout(() => {
                        const approvalSystem = document.querySelector('.approval-system');
                        const approvedCase = document.getElementById('approved-case');
                        
                        if (approvalSystem && approvedCase) {
                            approvalSystem.style.display = 'none';
                            approvedCase.style.display = 'block';
                            
                            // Update timeline
                            const timelineItems = document.querySelectorAll('.timeline-item');
                            if (timelineItems.length >= 4) {
                                timelineItems[2].innerHTML = `
                                    <div class="timeline-dot" style="background: var(--success);"><i class="fas fa-check"></i></div>
                                    <div class="timeline-content">
                                        <div class="timeline-date">Today, 1:30 PM</div>
                                        <div class="timeline-title">Doctor's Review Complete</div>
                                        <div class="timeline-description">Dr. Johnson approved your treatment plan</div>
                                    </div>
                                `;
                                
                                timelineItems[3].innerHTML = `
                                    <div class="timeline-dot" style="background: var(--success);"><i class="fas fa-check"></i></div>
                                    <div class="timeline-content">
                                        <div class="timeline-date">Today, 1:45 PM</div>
                                        <div class="timeline-title">Approval Complete</div>
                                        <div class="timeline-description">Your prescription is ready</div>
                                    </div>
                                `;
                            }
                            
                            showAlert('Your prescription has been approved by a doctor!', 'success');
                        }
                    }, 10000);
                }
            }, 1000);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication status on page load
            checkAuthStatus();
            
            // Navigation functionality
            const navLinks = document.querySelectorAll('.nav-link');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetPage = this.getAttribute('data-page');
                    
                    // If trying to access protected pages without login
                    if ((targetPage === 'consultation' || targetPage === 'approval' || targetPage === 'tracker') && !currentUser) {
                        navigateToPage('login');
                        showAlert('Please log in to access this feature.', 'info');
                        return;
                    }
                    
                    navigateToPage(targetPage);
                });
            });
            
            // Go to consultation button
            const goToConsultationBtn = document.querySelector('.go-to-consultation');
            if (goToConsultationBtn) {
                goToConsultationBtn.addEventListener('click', function() {
                    if (!currentUser) {
                        navigateToPage('login');
                        showAlert('Please log in to access the consultation feature.', 'info');
                        return;
                    }
                    
                    navigateToPage('consultation');
                });
            }
            
            // View approval status button in consultation results
            const viewApprovalStatusBtn = document.getElementById('view-approval-status');
            if (viewApprovalStatusBtn) {
                viewApprovalStatusBtn.addEventListener('click', function() {
                    navigateToPage('approval');
                });
            }
            
            document.getElementById('login-button').addEventListener('click', function() {
                navigateToPage('login');
            });
            
            document.getElementById('signup-button').addEventListener('click', function() {
                navigateToPage('login');
                document.getElementById('signup-link').click();
            });
            
            document.getElementById('logout-button').addEventListener('click', function() {
                localStorage.removeItem('smartDoctorUser');
                currentUser = null;
                updateUIForAuthState();
                navigateToPage('home');
                showAlert('You have been successfully logged out.', 'info');
            });
            
            document.getElementById('signup-link').addEventListener('click', function(e) {
                e.preventDefault();
                showAlert('Sign up functionality would be implemented here.', 'info');
            });
            
            const diagnoseButton = document.getElementById('diagnose-btn');
            const diagnosisResultContainer = document.getElementById('diagnosis-result-container');
            const resultPlaceholder = document.getElementById('result-placeholder');
            const loadingSpinner = document.getElementById('loading-spinner');
            const conditionElement = document.getElementById('condition-name');
            const diagnosisElement = document.getElementById('diagnosis-details');
            const prescriptionElement = document.getElementById('prescription-info');
            const treatmentElement = document.getElementById('treatment-plan');
            const accuracyElement = document.getElementById('accuracy-value');
            const confidenceProgress = document.getElementById('confidence-progress');
            
            if (diagnoseButton) {
                diagnoseButton.addEventListener('click', async function() {
                    const privacyConsent = document.getElementById('consent-privacy');
                    const termsConsent = document.getElementById('consent-terms');
                    const disclaimerConsent = document.getElementById('consent-disclaimer');
                    
                    if (!privacyConsent.checked || !termsConsent.checked || !disclaimerConsent.checked) {
                        showAlert('Please accept all consent agreements to use our consultation service.', 'error');
                        return false;
                    }
                    
                    const symptomInput = document.getElementById('symptom-input').value;
                    const selectedBodyParts = Array.from(document.querySelectorAll('.body-part.selected'))
                        .map(region => region.getAttribute('data-region'));
                    
                    if (!symptomInput.trim()) {
                        showAPIAlert("Please describe your symptoms first.", 'error');
                        return;
                    }
                    
                    // Show loading state
                    loadingSpinner.style.display = 'block';
                    diagnoseButton.disabled = true;
                    diagnoseButton.setAttribute('aria-busy', 'true');
                    
                    try {
                        // Call OpenRouter API
                        const diagnosis = await getAIDiagnosis(symptomInput, selectedBodyParts.join(', '));
                        
                        // Parse the response
                        const parsedDiagnosis = parseAIResponse(diagnosis);
                        
                        // Generate a random accuracy between 75-95%
                        const accuracy = Math.floor(Math.random() * 20) + 75;
                        
                        // Update the UI with the results
                        conditionElement.textContent = parsedDiagnosis.condition;
                        diagnosisElement.textContent = parsedDiagnosis.diagnosis;
                        prescriptionElement.textContent = parsedDiagnosis.prescription;
                        treatmentElement.textContent = parsedDiagnosis.treatment;
                        accuracyElement.textContent = `${accuracy}%`;
                        
                        // Update progress bar
                        confidenceProgress.style.width = `${accuracy}%`;
                        
                        // Show results
                        diagnosisResultContainer.style.display = 'block';
                        resultPlaceholder.style.display = 'none';
                        diagnoseButton.textContent = 'Get New Diagnosis';
                        
                        // Announce results for screen readers
                        const announcement = document.createElement('div');
                        announcement.setAttribute('aria-live', 'polite');
                        announcement.setAttribute('class', 'sr-only');
                        announcement.textContent = `Diagnosis complete with ${accuracy} percent accuracy. Condition: ${parsedDiagnosis.condition}`;
                        document.body.appendChild(announcement);
                        
                        setTimeout(() => {
                            document.body.removeChild(announcement);
                        }, 1000);
                        
                    } catch (error) {
                        console.error('Diagnosis error:', error);
                        showAPIAlert("Sorry, we're experiencing high demand. Please try again shortly.", 'error');
                    } finally {
                        loadingSpinner.style.display = 'none';
                        diagnoseButton.disabled = false;
                        diagnoseButton.setAttribute('aria-busy', 'false');
                    }
                });
            }
            
            // Voice button effect
            const voiceButton = document.querySelector('.voice-btn');
            if (voiceButton) {
                voiceButton.addEventListener('click', function() {
                    voiceButton.innerHTML = '<i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i> Listening...';
                    voiceButton.disabled = true;
                    
                    setTimeout(() => {
                        voiceButton.innerHTML = '<i class="fas fa-microphone" aria-hidden="true"></i> Start Recording';
                        voiceButton.disabled = false;
                        
                        // Add the recorded text to the symptoms input
                        document.getElementById('symptom-input').value = "I've been experiencing headache and fever since yesterday morning.";
                        
                        // Announce for screen readers
                        const announcement = document.createElement('div');
                        announcement.setAttribute('aria-live', 'polite');
                        announcement.setAttribute('class', 'sr-only');
                        announcement.textContent = "Voice input captured successfully";
                        document.body.appendChild(announcement);
                        
                        setTimeout(() => {
                            document.body.removeChild(announcement);
                        }, 1000);
                    }, 3000);
                });
            }
            
            // Body part selection
            const bodyParts = document.querySelectorAll('.body-part');
            const selectedSymptoms = document.getElementById('selected-symptoms');
            
            bodyParts.forEach(part => {
                part.addEventListener('click', function() {
                    this.classList.toggle('selected');
                    updateSelectedSymptoms();
                });
                
                part.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.classList.toggle('selected');
                        updateSelectedSymptoms();
                    }
                });
            });
            
            function updateSelectedSymptoms() {
                const selected = document.querySelectorAll('.body-part.selected');
                if (selected.length > 0) {
                    let symptomsText = 'Selected areas: ';
                    selected.forEach((part, index) => {
                        symptomsText += part.querySelector('span').textContent;
                        if (index < selected.length - 1) symptomsText += ', ';
                    });
                    selectedSymptoms.textContent = symptomsText;
                } else {
                    selectedSymptoms.textContent = '';
                }
            }
            
            // Login page functionality
            const loginForm = document.getElementById('login-form');
            const resetForm = document.getElementById('reset-password-form');
            const forgotPasswordLink = document.getElementById('forgot-password-link');
            const forgotPasswordModal = document.getElementById('forgot-password-modal');
            const closeModalBtn = document.querySelector('.close-modal');
            const passwordToggle = document.getElementById('password-toggle');
            const passwordInput = document.getElementById('password');
            const loginSubmitButton = document.getElementById('login-submit-button');
            const alertBox = document.getElementById('alert-box');
            
            // Toggle password visibility
            passwordToggle.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                
                // Toggle eye icon
                const eyeIcon = this.querySelector('i');
                eyeIcon.classList.toggle('fa-eye');
                eyeIcon.classList.toggle('fa-eye-slash');
            });
            
            // Show forgot password modal
            forgotPasswordLink.addEventListener('click', function(e) {
                e.preventDefault();
                forgotPasswordModal.style.display = 'flex';
            });
            
            // Close modal
            closeModalBtn.addEventListener('click', function() {
                forgotPasswordModal.style.display = 'none';
            });
            
            // Close modal if clicked outside
            window.addEventListener('click', function(e) {
                if (e.target === forgotPasswordModal) {
                    forgotPasswordModal.style.display = 'none';
                }
            });
            
            // Validate email format
            function isValidEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }
            
            // Login form submission
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;
                const rememberMe = document.getElementById('remember').checked;
                
                // Basic validation
                if (!email) {
                    showAlert('Please enter your email address', 'error');
                    return;
                }
                
                if (!isValidEmail(email)) {
                    showAlert('Please enter a valid email address', 'error');
                    return;
                }
                
                if (!password) {
                    showAlert('Please enter your password', 'error');
                    return;
                }
                
                // Show loading state
                loginSubmitButton.disabled = true;
                loginSubmitButton.classList.add('btn-loading');
                
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Check if credentials match any dummy user
                const user = dummyUsers.find(u => u.email === email && u.password === password);
                
                if (user) {
                    // Successful login
                    showAlert('Login successful! Redirecting to dashboard...', 'success');
                    
                    // Save user to localStorage
                    currentUser = { email: user.email, name: user.name };
                    if (rememberMe) {
                        localStorage.setItem('smartDoctorUser', JSON.stringify(currentUser));
                    }
                    
                    // Update UI
                    updateUIForAuthState();
                    
                    setTimeout(() => {
                        // Redirect to consultation page
                        navigateToPage('consultation');
                        loginSubmitButton.disabled = false;
                        loginSubmitButton.classList.remove('btn-loading');
                    }, 1500);
                } else {
                    // Failed login
                    showAlert('Invalid email or password. Please try again.', 'error');
                    loginSubmitButton.disabled = false;
                    loginSubmitButton.classList.remove('btn-loading');
                }
            });
            
            // Reset password form
            resetForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('reset-email').value.trim();
                
                if (!email || !isValidEmail(email)) {
                    showAlert('Please enter a valid email address', 'error');
                    return;
                }
                
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Show success message (regardless of whether email exists for security)
                showAlert('If this email is registered, you will receive password reset instructions shortly.', 'info');
                forgotPasswordModal.style.display = 'none';
                resetForm.reset();
            });
            
            // Social login buttons
            const socialButtons = document.querySelectorAll('.btn-social');
            socialButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const platform = this.querySelector('span').textContent;
                    showAlert(`${platform} authentication would be implemented here.`, 'info');
                });
            });
            
            // Virtual Consultation Booking Functionality
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('consultation-date').setAttribute('min', today);
            
            // Get modal elements
            const consultationModal = document.getElementById('consultation-modal');
            const closeConsultationModalBtn = document.querySelector('.close-consultation-modal');
            const virtualConsultBtns = document.querySelectorAll('.virtual-consult-btn');
            const timeSlots = document.querySelectorAll('.time-slot');
            const bookConsultationBtn = document.getElementById('book-consultation-btn');
            const consultationForm = document.getElementById('consultation-form');
            const consultationSuccess = document.getElementById('consultation-success');
            const closeSuccessBtn = document.getElementById('close-consultation-success');
            const consultationPharmacy = document.getElementById('consultation-pharmacy');
            
            // Open modal when virtual consultation button is clicked
            virtualConsultBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const pharmacyName = this.closest('.pharmacy-card').querySelector('h5').textContent;
                    consultationPharmacy.value = pharmacyName;
                    
                    // Pre-fill user info if logged in
                    if (currentUser) {
                        document.getElementById('consultation-name').value = currentUser.name || '';
                        document.getElementById('consultation-email').value = currentUser.email || '';
                    }
                    
                    consultationModal.style.display = 'flex';
                });
            });
            
            // Close modal
            closeConsultationModalBtn.addEventListener('click', function() {
                consultationModal.style.display = 'none';
                resetConsultationForm();
            });
            
            // Close modal if clicked outside
            window.addEventListener('click', function(e) {
                if (e.target === consultationModal) {
                    consultationModal.style.display = 'none';
                    resetConsultationForm();
                }
            });
            
            // Time slot selection
            timeSlots.forEach(slot => {
                slot.addEventListener('click', function() {
                    // Remove selected class from all slots
                    timeSlots.forEach(s => s.classList.remove('selected'));
                    // Add selected class to clicked slot
                    this.classList.add('selected');
                });
            });
            
            // Book consultation
            bookConsultationBtn.addEventListener('click', function() {
                const name = document.getElementById('consultation-name').value;
                const email = document.getElementById('consultation-email').value;
                const phone = document.getElementById('consultation-phone').value;
                const date = document.getElementById('consultation-date').value;
                const selectedTimeSlot = document.querySelector('.time-slot.selected');
                const reason = document.getElementById('consultation-reason').value;
                
                // Basic validation
                if (!name.trim()) {
                    showAlert('Please enter your name', 'error');
                    return;
                }
                
                if (!email || !isValidEmail(email)) {
                    showAlert('Please enter a valid email address', 'error');
                    return;
                }
                
                if (!phone.trim()) {
                    showAlert('Please enter your phone number', 'error');
                    return;
                }
                
                if (!date) {
                    showAlert('Please select a date for your consultation', 'error');
                    return;
                }
                
                if (!selectedTimeSlot) {
                    showAlert('Please select a time slot for your consultation', 'error');
                    return;
                }
                
                if (!reason.trim()) {
                    showAlert('Please provide a reason for your consultation', 'error');
                    return;
                }
                
                // In a real application, you would send this data to your server
                // For this demo, we'll just show the success message
                
                // Show success message
                consultationForm.style.display = 'none';
                consultationSuccess.style.display = 'block';
            });
            
            // Close success message
            closeSuccessBtn.addEventListener('click', function() {
                consultationModal.style.display = 'none';
                consultationSuccess.style.display = 'none';
                consultationForm.style.display = 'block';
                resetConsultationForm();
            });
            
            // Reset consultation form
            function resetConsultationForm() {
                document.getElementById('consultation-name').value = '';
                document.getElementById('consultation-email').value = '';
                document.getElementById('consultation-phone').value = '';
                document.getElementById('consultation-date').value = '';
                document.getElementById('consultation-reason').value = '';
                timeSlots.forEach(slot => slot.classList.remove('selected'));
            }
            
            // Doctor Approval System Functionality
            // Refresh status button
            const refreshBtn = document.getElementById('refresh-status');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    this.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Checking...';
                    
                    // Simulate API call to check status
                    setTimeout(() => {
                        this.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh Status';
                        showAlert('Status updated. No changes yet.', 'info');
                    }, 1500);
                });
            }
            
            // Contact doctor button
            const contactDoctorBtn = document.getElementById('contact-doctor');
            const doctorMessageModal = document.getElementById('doctor-message-modal');
            
            if (contactDoctorBtn) {
                contactDoctorBtn.addEventListener('click', function() {
                    doctorMessageModal.style.display = 'flex';
                });
            }
            
            // View AI results button
            const viewAIResultsBtn = document.getElementById('view-ai-results');
            if (viewAIResultsBtn) {
                viewAIResultsBtn.addEventListener('click', function() {
                    navigateToPage('consultation');
                });
            }
            
            // Legal document modals
            const privacyPolicyLink = document.getElementById('privacy-policy-link');
            const termsOfUseLink = document.getElementById('terms-of-use-link');
            const privacyPolicyModal = document.getElementById('privacy-policy-modal');
            const termsOfUseModal = document.getElementById('terms-of-use-modal');
            
            // Open privacy policy modal
            if (privacyPolicyLink) {
                privacyPolicyLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    privacyPolicyModal.style.display = 'flex';
                });
            }
            
            // Open terms of use modal
            if (termsOfUseLink) {
                termsOfUseLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    termsOfUseModal.style.display = 'flex';
                });
            }
            
            // Message doctor form submission
            const messageDoctorForm = document.getElementById('message-doctor-form');
            if (messageDoctorForm) {
                messageDoctorForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const submitBtn = this.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Sending...';
                    submitBtn.disabled = true;
                    
                    // Simulate sending message
                    setTimeout(() => {
                        doctorMessageModal.style.display = 'none';
                        showAlert('Your message has been sent to the doctor. You will receive a response soon.', 'success');
                        messageDoctorForm.reset();
                        
                        submitBtn.innerHTML = 'Send Message';
                        submitBtn.disabled = false;
                    }, 1500);
                });
            }
            
            // Close modal buttons
            const closeModalBtns = document.querySelectorAll('.close-modal');
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            // Close modal if clicked outside
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
            
            // Start the simulation when page loads
            const approvalPage = document.getElementById('approval-page');
            if (approvalPage.classList.contains('active')) {
                simulateApprovalProcess();
            }
        });
    </script>

    <!-- Treatment Tracker Script -->
   <!-- Treatment Tracker Script -->
    <script>
        // Treatment Tracker Functionality
        const todayKey = () => new Date().toISOString().slice(0,10);

        function saveLocal(key, data) { 
            localStorage.setItem(key, JSON.stringify(data)); 
        }

        function loadLocal(key, fallback) { 
            try { 
                return JSON.parse(localStorage.getItem(key)) ?? fallback; 
            } catch { 
                return fallback; 
            } 
        }

        function download(filename, text) {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(new Blob([text], {type:'application/json'}));
            a.download = filename; 
            a.click(); 
            URL.revokeObjectURL(a.href);
        }

        let plan = loadLocal('tt_plan', {
            id: (crypto.randomUUID ? crypto.randomUUID() : String(Math.random()).slice(2)),
            title: '', 
            condition: '', 
            start: '', 
            end: '', 
            notes: '', 
            tasks: [], 
            done: {}
        });

        function renderTasks() {
            const list = document.getElementById('taskList'); 
            list.innerHTML = '';
            
            if (!plan.tasks.length) { 
                list.innerHTML = '<div class="tracker-empty">No tasks yet. Add medications or activities above.</div>'; 
                return; 
            }
            
            const doneToday = plan.done[todayKey()] || {};
            let completed = 0; 
            let total = 0;
            
            plan.tasks.forEach(t => {
                const item = document.createElement('div'); 
                item.className = 'tracker-task' + (doneToday[t.id]?.every(Boolean) ? ' done' : '');
                
                const left = document.createElement('div'); 
                left.style.display = 'grid'; 
                left.style.placeItems = 'center';
                left.innerHTML = `<input type="checkbox" ${doneToday[t.id]?.every(Boolean) ? 'checked' : ''} />`;
                
                const main = document.createElement('div');
                const timesDisp = t.times.length ? `<small>${t.times.join(', ')}</small>` : '';
                main.innerHTML = `<strong>${t.name}</strong><br>${t.freq === 'custom' ? `${t.times.length}/day` : `${t.freq}/day`} ${timesDisp}`;
                
                const right = document.createElement('div'); 
                right.innerHTML = `<button class="btn" data-edit="${t.id}" style="padding: 5px 10px;"><i class="fa-solid fa-pen"></i></button> <button class="btn" data-del="${t.id}" style="padding: 5px 10px; background: var(--danger); color: white;"><i class="fa-solid fa-xmark"></i></button>`;
                
                item.append(left, main, right); 
                list.append(item);

                // Sub-checklist for doses within the day
                const sub = document.createElement('div'); 
                sub.style.gridColumn = '1 / -1'; 
                sub.style.display = 'flex'; 
                sub.style.flexWrap = 'wrap'; 
                sub.style.gap = '8px'; 
                sub.style.marginTop = '8px';
                
                const doses = t.times.length || Number(t.freq);
                for (let i = 0; i < doses; i++) {
                    total++;
                    const checked = (doneToday[t.id] || [])[i] === true; 
                    if (checked) completed++;
                    
                    const chip = document.createElement('span'); 
                    chip.className = 'tracker-badge'; 
                    chip.style.cursor = 'pointer'; 
                    chip.dataset.task = t.id; 
                    chip.dataset.idx = i;
                    chip.innerHTML = `${checked ? '<i class="fa-solid fa-check"></i>' : '<i class="fa-regular fa-square"></i>'} Dose ${i+1}`;
                    sub.append(chip);
                }
                list.append(sub);
            });
            
            const pct = total ? Math.round(100 * completed / total) : 0;
            document.getElementById('planProgress').style.width = pct + '%';
            document.getElementById('adherence').textContent = pct + '%';
        }

        function renderSaved() {
            const cont = document.getElementById('savedPlans'); 
            const empty = document.getElementById('savedEmpty');
            const all = loadLocal('tt_saved', []);
            cont.innerHTML = '';
            
            if (!all.length) { 
                empty.style.display = 'block'; 
                return; 
            }
            
            empty.style.display = 'none';
            
            all.forEach(p => {
                const card = document.createElement('div'); 
                card.className = 'tracker-card';
                card.innerHTML = `
                    <div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span class="tracker-pill"><i class="fa-solid fa-clipboard-list"></i> ${p.title || 'Untitled Plan'}</span>
                            <div style="display: flex; gap: 5px;">
                                <button class="btn" data-load="${p.id}" style="padding: 5px 10px;"><i class="fa-solid fa-upload"></i></button>
                                <button class="btn" data-remove="${p.id}" style="padding: 5px 10px; background: var(--danger); color: white;"><i class="fa-solid fa-trash"></i></button>
                            </div>
                        </div>
                        <div class="hint">${p.condition || ''}  ${p.start || '?'}  ${p.end || '?'}</div>
                    </div>
                `;
                cont.append(card);
            });
        }

        function persist() { 
            saveLocal('tt_plan', plan); 
            renderTasks(); 
        }

        // Add task
        document.getElementById('addTask').addEventListener('click', () => {
            const name = document.getElementById('taskName').value.trim(); 
            if (!name) return alert('Enter a task/medication name');
            
            const freqSel = document.getElementById('taskFreq').value;
            const timesRaw = document.getElementById('taskTimes').value.trim();
            const times = timesRaw ? timesRaw.split(',').map(s => s.trim()).filter(Boolean) : [];
            const freq = freqSel === 'custom' ? (times.length || 1) : Number(freqSel);
            
            const t = { 
                id: (crypto.randomUUID ? crypto.randomUUID() : String(Math.random()).slice(2)), 
                name, 
                freq, 
                times 
            };
            
            plan.tasks.push(t);
            document.getElementById('taskName').value = '';
            document.getElementById('taskTimes').value = '';
            persist();
        });

        // Toggle dose chip
        document.getElementById('taskList').addEventListener('click', (e) => {
            const chip = e.target.closest('.tracker-badge'); 
            if (!chip) return;
            
            const { task, idx } = chip.dataset; 
            const d = plan.done[todayKey()] || {}; 
            const arr = d[task] || [];
            arr[idx] = !arr[idx]; 
            d[task] = arr; 
            plan.done[todayKey()] = d; 
            persist();
        });

        // Edit / delete
        document.getElementById('taskList').addEventListener('click', (e) => {
            const del = e.target.closest('[data-del]'); 
            const edit = e.target.closest('[data-edit]');
            
            if (del) { 
                plan.tasks = plan.tasks.filter(t => t.id !== del.dataset.del); 
                persist(); 
            }
            
            if (edit) {
                const t = plan.tasks.find(x => x.id === edit.dataset.edit); 
                if (!t) return;
                
                const name = prompt('Task/Medication name', t.name); 
                if (name === null) return;
                
                const times = prompt('Times (comma-separated HH:MM), or leave empty', t.times.join(', '));
                t.name = name.trim(); 
                t.times = (times || '').split(',').map(s => s.trim()).filter(Boolean);
                persist();
            }
        });

        // Save plan
        document.getElementById('savePlan').addEventListener('click', () => {
            plan.title = document.getElementById('planTitle').value.trim();
            plan.condition = document.getElementById('planCondition').value.trim();
            plan.start = document.getElementById('planStart').value; 
            plan.end = document.getElementById('planEnd').value; 
            plan.notes = document.getElementById('planNotes').value.trim();
            
            persist();
            
            const all = loadLocal('tt_saved', []);
            const i = all.findIndex(p => p.id === plan.id); 
            
            if (i >= 0) {
                all[i] = plan;
            } else {
                all.push({...plan});
            }
            
            saveLocal('tt_saved', all);
            renderSaved(); 
            alert('Plan saved');
        });

        // Export / import / clear
        document.getElementById('exportPlan').addEventListener('click', () => {
            download(`treatment-plan-${(plan.title || 'untitled').replace(/\s+/g, '-')}.json`, JSON.stringify(plan, null, 2)); 
        });

        document.getElementById('importPlan').addEventListener('change', async (e) => {
            const file = e.target.files[0]; 
            if (!file) return; 
            
            const text = await file.text();
            try { 
                plan = JSON.parse(text); 
                persist(); 
                hydrateForm(); 
                alert('Plan imported'); 
            } catch { 
                alert('Invalid JSON'); 
            }
        });

        document.getElementById('clearPlan').addEventListener('click', () => {
            if (!confirm('Delete current plan and daily progress?')) return;
            
            plan = { 
                id: (crypto.randomUUID ? crypto.randomUUID() : String(Math.random()).slice(2)), 
                title: '', 
                condition: '', 
                start: '', 
                end: '', 
                notes: '', 
                tasks: [], 
                done: {} 
            };
            
            persist(); 
            hydrateForm();
        });

        // Saved plans actions
        document.getElementById('savedPlans').addEventListener('click', (e) => {
            const loadBtn = e.target.closest('[data-load]'); 
            const rmBtn = e.target.closest('[data-remove]');
            const all = loadLocal('tt_saved', []);
            
            if (loadBtn) { 
                const id = loadBtn.dataset.load; 
                const p = all.find(x => x.id === id); 
                
                if (p) { 
                    plan = p; 
                    saveLocal('tt_plan', plan); 
                    hydrateForm(); 
                    persist(); 
                    alert('Loaded'); 
                } 
            }
            
            if (rmBtn) { 
                const id = rmBtn.dataset.remove; 
                saveLocal('tt_saved', all.filter(x => x.id !== id)); 
                renderSaved(); 
            }
        });

        function hydrateForm() {
            document.getElementById('planTitle').value = plan.title || ''; 
            document.getElementById('planCondition').value = plan.condition || ''; 
            document.getElementById('planStart').value = plan.start || ''; 
            document.getElementById('planEnd').value = plan.end || ''; 
            document.getElementById('planNotes').value = plan.notes || '';
        }

        // Initial render
        hydrateForm(); 
        renderTasks(); 
        renderSaved();

        // Daily reset marker
        const lastDay = loadLocal('tt_last_day', null);
        const today = todayKey();

        if (lastDay !== today) { 
            saveLocal('tt_last_day', today); 
        }
    </script>
</body>
</html>